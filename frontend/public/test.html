<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-box {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        button {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
    </style>
</head>
<body>
    <h1>üîç –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±—ç–∫–µ–Ω–¥—É</h1>
    
    <div class="test-box">
        <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ</h2>
        <p><strong>URL:</strong> <span id="frontend-url"></span></p>
        <p><strong>Backend URL (–∏–∑ env):</strong> <span id="backend-url-env"></span></p>
        <p><strong>Backend URL (–æ–∂–∏–¥–∞–µ–º—ã–π):</strong> https://strategy-game-pvnb.onrender.com</p>
    </div>

    <div class="test-box">
        <h2>–¢–µ—Å—Ç API –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h2>
        <button onclick="testAPI()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å API</button>
        <div id="api-result"></div>
    </div>

    <div class="test-box">
        <h2>–¢–µ—Å—Ç WebSocket</h2>
        <button onclick="testWebSocket()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å WebSocket</button>
        <div id="ws-result"></div>
    </div>

    <div class="test-box">
        <h2>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è</h2>
        <div id="env-check"></div>
    </div>

    <script>
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π URL
        document.getElementById('frontend-url').textContent = window.location.href;
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (–¥–ª—è Vite –æ–Ω–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ import.meta.env)
        const envCheck = document.getElementById('env-check');
        envCheck.innerHTML = `
            <p><strong>VITE_BACKEND_URL:</strong> ${typeof import !== 'undefined' && import.meta?.env?.VITE_BACKEND_URL || '–ù–ï –£–°–¢–ê–ù–û–í–õ–ï–ù–ê'}</p>
            <p class="error">‚ö†Ô∏è –ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞, –¥–æ–±–∞–≤—å—Ç–µ –µ—ë –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Vercel!</p>
        `;
        
        const backendUrl = typeof import !== 'undefined' && import.meta?.env?.VITE_BACKEND_URL || 'https://strategy-game-pvnb.onrender.com';
        document.getElementById('backend-url-env').textContent = backendUrl || '–ù–ï –£–°–¢–ê–ù–û–í–õ–ï–ù–ê';

        async function testAPI() {
            const resultDiv = document.getElementById('api-result');
            resultDiv.innerHTML = '<p class="info">–ü—Ä–æ–≤–µ—Ä–∫–∞...</p>';
            
            const backendUrl = typeof import !== 'undefined' && import.meta?.env?.VITE_BACKEND_URL || 'https://strategy-game-pvnb.onrender.com';
            
            try {
                const response = await fetch(`${backendUrl}/api/test`);
                const data = await response.json();
                resultDiv.innerHTML = `
                    <p class="success">‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç!</p>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <p class="error">‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ API</p>
                    <p>${error.message}</p>
                    <p>URL: ${backendUrl}/api/test</p>
                `;
            }
        }

        function testWebSocket() {
            const resultDiv = document.getElementById('ws-result');
            resultDiv.innerHTML = '<p class="info">–ü—Ä–æ–≤–µ—Ä–∫–∞ WebSocket...</p>';
            
            const backendUrl = typeof import !== 'undefined' && import.meta?.env?.VITE_BACKEND_URL || 'https://strategy-game-pvnb.onrender.com';
            const wsUrl = backendUrl.replace('https://', 'wss://').replace('http://', 'ws://');
            
            try {
                const ws = new WebSocket(`${wsUrl}/ws/test/test`);
                
                ws.onopen = () => {
                    resultDiv.innerHTML = '<p class="success">‚úÖ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω!</p>';
                    ws.close();
                };
                
                ws.onerror = (error) => {
                    resultDiv.innerHTML = `
                        <p class="error">‚ùå –û—à–∏–±–∫–∞ WebSocket</p>
                        <p>URL: ${wsUrl}/ws/test/test</p>
                        <p>–í–æ–∑–º–æ–∂–Ω–æ, Render –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç WebSocket –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–º –ø–ª–∞–Ω–µ</p>
                    `;
                };
                
                ws.onclose = (event) => {
                    if (event.code !== 1000) {
                        resultDiv.innerHTML = `
                            <p class="error">‚ùå WebSocket –∑–∞–∫—Ä—ã—Ç —Å –∫–æ–¥–æ–º: ${event.code}</p>
                            <p>–ü—Ä–∏—á–∏–Ω–∞: ${event.reason || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</p>
                        `;
                    }
                };
                
                setTimeout(() => {
                    if (ws.readyState === WebSocket.CONNECTING) {
                        ws.close();
                        resultDiv.innerHTML = '<p class="error">‚è±Ô∏è –¢–∞–π–º–∞—É—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è - WebSocket –º–æ–∂–µ—Ç –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è</p>';
                    }
                }, 5000);
            } catch (error) {
                resultDiv.innerHTML = `
                    <p class="error">‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è WebSocket</p>
                    <p>${error.message}</p>
                `;
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            setTimeout(testAPI, 1000);
        });
    </script>
</body>
</html>

